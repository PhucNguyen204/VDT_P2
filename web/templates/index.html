<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{.title}}</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="/static/css/dashboard.css" rel="stylesheet">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="/">
                <i class="fas fa-shield-alt"></i>
                EDR Security Dashboard
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav me-auto">
                    <li class="nav-item">
                        <a class="nav-link active" href="#dashboard">
                            <i class="fas fa-tachometer-alt"></i> Dashboard
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#alerts">
                            <i class="fas fa-exclamation-triangle"></i> Cảnh báo
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#events">
                            <i class="fas fa-list"></i> Sự kiện
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#agents">
                            <i class="fas fa-desktop"></i> Agents
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#process-trees">
                            <i class="fas fa-sitemap"></i> Process Trees
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="#rules">
                            <i class="fas fa-cogs"></i> Sigma Rules
                        </a>
                    </li>
                </ul>
                <ul class="navbar-nav">
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown">
                            <i class="fas fa-user"></i> Admin
                        </a>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#settings">Cài đặt</a></li>
                            <li><hr class="dropdown-divider"></li>
                            <li><a class="dropdown-item" href="#logout">Đăng xuất</a></li>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container-fluid mt-5 pt-3">
        <!-- Dashboard Section -->
        <div id="dashboard" class="content-section">
            <div class="row mb-4">
                <div class="col-12">
                    <h2><i class="fas fa-tachometer-alt"></i> Tổng quan hệ thống</h2>
                </div>
            </div>

            <!-- Statistics Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-primary text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title">Tổng số sự kiện</h4>
                                    <h2 id="total-events">0</h2>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-list fa-3x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-danger text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title">Cảnh báo nguy hiểm</h4>
                                    <h2 id="critical-alerts">0</h2>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-exclamation-triangle fa-3x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-success text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title">Agents hoạt động</h4>
                                    <h2 id="active-agents">0</h2>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-desktop fa-3x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-info text-white">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h4 class="card-title">Process Trees</h4>
                                    <h2 id="process-trees-count">0</h2>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-sitemap fa-3x"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Row -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Cảnh báo theo mức độ nghiêm trọng</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="alertSeverityChart"></canvas>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>Sự kiện theo thời gian</h5>
                        </div>
                        <div class="card-body">
                            <canvas id="eventsTimeChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Alerts Table -->
            <div class="row">
                <div class="col-12">
                    <div class="card">
                        <div class="card-header">
                            <h5>Cảnh báo gần đây</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table id="recent-alerts-table" class="table table-striped">
                                    <thead>
                                        <tr>
                                            <th>Thời gian</th>
                                            <th>Tiêu đề</th>
                                            <th>Mức độ</th>
                                            <th>Agent</th>
                                            <th>Trạng thái</th>
                                            <th>Hành động</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <!-- Data will be loaded via JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Alerts Section -->
        <div id="alerts" class="content-section" style="display: none;">
            <div class="row mb-4">
                <div class="col-12">
                    <h2><i class="fas fa-exclamation-triangle"></i> Quản lý cảnh báo</h2>
                </div>
            </div>

            <!-- Filters -->
            <div class="row mb-3">
                <div class="col-md-3">
                    <select class="form-select" id="severity-filter">
                        <option value="">Tất cả mức độ</option>
                        <option value="critical">Critical</option>
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="col-md-3">
                    <select class="form-select" id="status-filter">
                        <option value="">Tất cả trạng thái</option>
                        <option value="open">Mở</option>
                        <option value="investigating">Đang điều tra</option>
                        <option value="resolved">Đã giải quyết</option>
                        <option value="false_positive">False Positive</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <input type="text" class="form-control" id="search-input" placeholder="Tìm kiếm...">
                </div>
                <div class="col-md-2">
                    <button class="btn btn-primary" onclick="loadAlerts()">
                        <i class="fas fa-search"></i> Tìm kiếm
                    </button>
                </div>
            </div>

            <!-- Alerts Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="alerts-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Thời gian</th>
                                    <th>Tiêu đề</th>
                                    <th>Mức độ</th>
                                    <th>Agent</th>
                                    <th>Rule</th>
                                    <th>Trạng thái</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Events Section -->
        <div id="events" class="content-section" style="display: none;">
            <div class="row mb-4">
                <div class="col-12">
                    <h2><i class="fas fa-list"></i> Sự kiện hệ thống</h2>
                </div>
            </div>

            <!-- Events Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="events-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Thời gian</th>
                                    <th>Loại</th>
                                    <th>Agent</th>
                                    <th>Process</th>
                                    <th>Command Line</th>
                                    <th>User</th>
                                    <th>Mức độ</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Agents Section -->
        <div id="agents" class="content-section" style="display: none;">
            <div class="row mb-4">
                <div class="col-12">
                    <h2><i class="fas fa-desktop"></i> Quản lý Agents</h2>
                </div>
            </div>

            <!-- Agents Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="agents-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Hostname</th>
                                    <th>IP Address</th>
                                    <th>OS</th>
                                    <th>Phiên bản Agent</th>
                                    <th>Trạng thái</th>
                                    <th>Lần cuối kết nối</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <!-- Process Trees Section -->
        <div id="process-trees" class="content-section" style="display: none;">
            <div class="row mb-4">
                <div class="col-12">
                    <h2><i class="fas fa-sitemap"></i> Process Trees</h2>
                </div>
            </div>

            <!-- Process Tree Visualization -->
            <div class="card">
                <div class="card-header">
                    <h5>Process Tree Visualization</h5>
                </div>
                <div class="card-body">
                    <div id="process-tree-graph" style="height: 500px;"></div>
                </div>
            </div>
        </div>

        <!-- Sigma Rules Section -->
        <div id="rules" class="content-section" style="display: none;">
            <div class="row mb-4">
                <div class="col-12">
                    <h2><i class="fas fa-cogs"></i> Sigma Rules</h2>
                </div>
            </div>

            <!-- Rules Actions -->
            <div class="row mb-3">
                <div class="col-12">
                    <button class="btn btn-success" onclick="reloadRules()">
                        <i class="fas fa-sync"></i> Reload Rules
                    </button>
                </div>
            </div>

            <!-- Rules Table -->
            <div class="card">
                <div class="card-body">
                    <div class="table-responsive">
                        <table id="rules-table" class="table table-striped">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Tiêu đề</th>
                                    <th>Mức độ</th>
                                    <th>Trạng thái</th>
                                    <th>Author</th>
                                    <th>Tags</th>
                                    <th>Enabled</th>
                                    <th>Hành động</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Data will be loaded via JavaScript -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Alert Detail Modal -->
    <div class="modal fade" id="alertModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Chi tiết cảnh báo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Alert details will be loaded here -->
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-primary" onclick="updateAlertStatus()">Cập nhật trạng thái</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="/static/js/dashboard.js"></script>
</body>
</html>
